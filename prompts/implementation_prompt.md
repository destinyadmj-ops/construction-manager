# 実装依頼用・統合プロンプト（Master Hub）

以下をそのまま AI / コーディングエージェントに貼り付け、`< >` の中だけ埋めて使ってください。

---

## 0) 依頼内容（今回のゴール）

**やりたいこと**
- <何を実装したいかを1〜3行で>

**背景/目的**
- <なぜ必要か>

**対象ユーザー/利用シーン**
- <誰がいつ使うか>

---

## 1) 参照ドキュメント（必読）

このリポジトリでは、以下のファイルを “仕様の正” として扱う。

- 要件: `prompts/requirements.md`
- 用語: `prompts/glossary.md`
- スキーマ: `prompts/schemas.md` と `prisma/schema.prisma`
- テスト観点: `prompts/tests.md`

不明点がある場合は、まず上記を読んで矛盾がないか確認する。

---

## 2) 技術スタック/前提

- Next.js（App Router）+ TypeScript
- Prisma（生成先: `src/generated/prisma`）
- BullMQ + Redis（ジョブキュー）
- Postgres（Docker Compose）
- Playwright（E2E）

開発・確認で使えるコマンド（例）:
- `npm run docker:up`
- `npx prisma generate`
- `npx prisma migrate deploy`
- `npm run lint` / `npm run typecheck` / `npm run build`
- `npm run e2e`

VS Code タスク（任意・使えるなら）:
- `bootstrap: base check`
- `run: dev + worker`
- `run: prod (build + start)`

---

## 3) 守るべき制約（重要）

- **ビルド時に外部依存へ接続しない**
  - 例: import 時に Redis/DB 接続を作らない
  - 例: `next build` / 静的生成の段階で外部接続しない
- 既存の設計方針と整合させる（とくに Queue/Worker は lazy 生成の方針）
- 余計なページ/機能を増やさない（依頼に書いていないことは実装しない）
- 既存スタイル（lint/typecheck）を壊さない
- 生成物（`src/generated/**` 等）は直接編集しない

---

## 4) 実装の進め方（期待する振る舞い）

1. **最初に最小の質問をする（最大3つ）**
   - 仕様が曖昧な箇所だけ確認する。質問が不要なら質問しない。
2. **短い実装プランを提示してから着手**
   - 変更ファイルの候補、追加するAPI/モデル、テスト観点など。
3. **実装**
   - 既存パターンに合わせる。余計な抽象化はしない。
4. **検証**
   - 変更範囲に応じて `lint/typecheck/build/e2e` を段階的に実行。
5. **完了報告**
   - 何を変更したか、どこを触ったか、どう確認したかを短くまとめる。

---

## 5) 成果物の要件（今回の依頼に合わせて記入）

- UI要件:
  - <画面が必要なら、最小の見た目/導線>
- API要件:
  - <エンドポイント、入力/出力、ステータスコード>
- DB要件:
  - <テーブル追加/変更の有無>
- キュー/ワーカー要件:
  - <ジョブ名、ペイロード、再試行、タイムアウト>

---

## 6) 受け入れ条件（最低ライン）

最低でも以下を満たすこと。

- `npm run lint` が成功
- `npm run typecheck` が成功
- `npm run build` が成功（外部接続エラーを出さない）
- 可能なら `npm run e2e` で最低1本は通る（既存があるなら維持）

必要なら、今回機能の最小スモーク（API叩き、画面表示など）も追加する。

---

## 7) 今回の実装依頼（詳細）

ここに詳細を書いてください。

- <箇条書きで仕様>
- <エッジケース>
- <例: 入力サンプル/期待出力>

---

## 8) 既知の注意点（このプロジェクト特有）

- BullMQ/Redis は **import時に接続を作らない**（ビルド中に接続試行が走る事故を防ぐ）
- Redis が落ちている時、enqueue 系 API はハングせず `503` 等で早期失敗するのが望ましい
- Playwright は `127.0.0.1` を使う前提（`localhost` で失敗する環境があるため）
